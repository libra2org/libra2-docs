---
title: "Node Health"
---

import { Aside } from '@astrojs/starlight/components';

This document describes how you can verify and monitor the health of your validator and validator fullnode (VFN) in the
Libra2 network. Many of the methods described here rely on the runtime metrics that your nodes collect and report. These
metrics are collected by the Libra2 node binary and are exposed via a Prometheus metrics endpoint. For a detailed
description of the important metrics, see the [Node Inspection Service](/network/nodes/measure/node-inspection-service) and
[Important Node Metrics](/network/nodes/measure/important-metrics) documentation.

## Initial Node Verification

After deploying your nodes and connecting them to the Libra2 network, you should verify that your nodes are running
correctly.

<Aside type="note">
  **FIRST TIME?**<br />
  In some environments, e.g., `mainnet` and `testnet`, your VFN will begin syncing first (before your validator is able to sync).
  This is normal behaviour. Once your VFN has finished syncing, your validator node will start syncing and eventually start participating in consensus.
</Aside>

You can verify the correctness of your nodes by inspecting several simple metrics. Follow these steps:

1. Check if your nodes are state syncing by running this command:

   ```shellscript filename="Terminal"
   curl 127.0.0.1:9101/metrics 2> /dev/null | grep "libra2_state_sync_version"
   ```

   You should expect to see the `synced` or `synced_states` versions increasing. The versions should start increasing
   for your VFN first, then eventually your validator node will start syncing.

   <Aside type="note">
     **CLOUD DEPLOYMENT?**<br />
     You may need to replace `127.0.0.1` with your validator or VFN IP/DNS if deployed on the cloud.
   </Aside>

2. Verify that your validator is connecting to other peers on the network.

   ```shellscript filename="Terminal"
   curl 127.0.0.1:9101/metrics 2> /dev/null | grep "libra2_connections{.*\"Validator\".*}"
   ```

   The command will output the number of inbound and outbound connections of your validator node. For example:

   ```shellscript filename="Terminal"
   libra2_connections{direction="inbound",network_id="Validator",peer_id="f326fd30",role_type="validator"} 5
   libra2_connections{direction="outbound",network_id="Validator",peer_id="f326fd30",role_type="validator"} 2
   ```

   As long as one of the metrics is greater than zero, your validator node is connected to at least one of the peers on the network. If your validator is not
   connected to any peers, make sure your VFN has completed syncing first. Once your VFN has finished syncing, your validator
   node will start syncing and eventually be able to connect to other peers.

3. After your node syncs to the latest version, you can also check if consensus is making progress, and your node is proposing.

   ```shellscript filename="Terminal"
   curl 127.0.0.1:9101/metrics 2> /dev/null | grep "libra2_consensus_current_round"

   curl 127.0.0.1:9101/metrics 2> /dev/null | grep "libra2_consensus_proposals_count"
   ```

   You should expect to see these numbers continue to increase.

## Local Monitoring

If you are a node operator, there are several tools available to you to verify the health of your node going forward:

- **Metrics:** You can monitor your local metrics endpoint by running a `curl` command against the
  [Node Inspection Service](/network/nodes/measure/node-inspection-service) and verify key metrics. For example, you can
  verify the synchronization status of your node by running the command outlined in the
  [Verify synchronization](/network/nodes/full-node/verify-pfn#verify-synchronization) section.

- **REST API:** You can also monitor your node's health by querying the REST API. For example, you can verify the
  current block height of your node by pinging the index page of your node's REST API. For more information, see the
  [Libra2 API Specification](/build/apis/fullnode-rest-api).

- **Monitoring tools:** To improve observability, you can also install monitoring tools that scrape the local metrics endpoint:
  - For Kubernetes based deployments, install the monitoring Helm chart ([https://github.com/libra2org/libra2-core/tree/main/terraform/helm/monitoring](https://github.com/libra2org/libra2-core/tree/main/terraform/helm/monitoring)).
  - Locally, you may run Prometheus and Grafana directly. Dashboards that utilize the metrics can be found here: ([https://github.com/libra2org/libra2-core/tree/main/dashboards](https://github.com/libra2org/libra2-core/tree/main/dashboards)).

## Telemetry

The Libra2 Foundation team can also monitor your node remotely using [Node Telemetry](/network/nodes/configure/telemetry). When you enable telemetry on
your nodes, the Libra2 node binary will send telemetry data in the background, which includes the node's metrics.
Telemetry data from your node is necessary to evaluate the performance, liveness and health of your nodes.

If your node is using the default config without explicitly disabling telemetry, and has `HTTPS` egress access to the
internet, then it will report various key metrics to Libra2 Foundation. Libra2 Foundation will also observe the on-chain events
such as proposals per hour on your node, as defined in the liveness criteria.
